<html><body><div class="topic-text"><!--Begin of %META:TOPICPARENT{name="VirtTipsAndTricksGuide"}%--><p> </p>
<!--End of %META:TOPICPARENT{name="VirtTipsAndTricksGuide"}%--><h1><a name="Virtuoso Diagnostics for Query Optimization"></a> Virtuoso Diagnostics for Query Optimization</h1>
<p>Queries involving a large number of possible plans may run out of memory during optimization.
 There are a number of settings that influence query optimization memory utilization.</p>
<p>These are set in the <code>virtuoso.ini</code> file, or can be altered on a running system with the <b><code><a href="http://docs.openlinksw.com/virtuoso/fn_dbf_set.html" class="absuri">__dbf_set()</a></code></b> function.</p>

<table class="wikitable"><tr><th id="0"><a href="http://ods.openlinksw.com:80/dataspace/owiki/wiki/ODS/VirtQueryOptDiagnostic?sort=0&col=1">INI section </a></th><th id="1"><a href="http://ods.openlinksw.com:80/dataspace/owiki/wiki/ODS/VirtQueryOptDiagnostic?sort=1&col=2">INI param name                                            </a></th><th id="2"><a href="http://ods.openlinksw.com:80/dataspace/owiki/wiki/ODS/VirtQueryOptDiagnostic?sort=2&col=3">default value          </a></th><th id="3"><a href="http://ods.openlinksw.com:80/dataspace/owiki/wiki/ODS/VirtQueryOptDiagnostic?sort=3&col=4">__dbf_set flag_name                                           </a></th><th id="4"><a href="http://ods.openlinksw.com:80/dataspace/owiki/wiki/ODS/VirtQueryOptDiagnostic?sort=4&col=5">__dbf_set flag_name description </a></th></tr><tr><td> Parameters    </td><td align="center">  <code>MaxMemPoolSize</code>               </td><td align="center">  <code>200000000</code>  </td><td align="center">  <code>sqlo_max_mp_size</code>                 </td><td> The <b><code>sqlo_max_mp_size</code></b> is a size limit in bytes for transient memory consumption. Increasing this may help. The <b><code>sqlo_max_mp_size</code> </b> should be over 10M; increasing this over 100M is seldom useful but can be tried.  </td></tr><tr><td> Parameters    </td><td align="center">  <code>MaxOptimizeLayouts</code>           </td><td align="center">  <code>1000</code>       </td><td align="center">  <code>sqlo_max_layouts</code>                 </td><td> Decreasing <b><code>sqlo_max_layouts</code></b> will reduce the number of plans tried, hence save memory. Reasonable values for <b><code>sqlo_max_layouts</code></b> are 0 for no limit, or somewhere in excess of 500.  </td></tr><tr><td> Parameters    </td><td align="center">  <code>StopCompilerWhenXOverRunTime</code> </td><td align="center">  <code>0</code>          </td><td align="center">  <code>sqlo_compiler_exceeds_run_factor</code> </td><td> Setting <b><code>sqlo_compiler_exceeds_run_factor</code></b> to 1 will stop opttimization once the best plan is expected to take less time than the amount of time spent optimizing so far.  </td></tr><tr><td> Flags         </td><td align="center">  <code>enable_joins_only</code>            </td><td align="center">  <code>1</code>          </td><td align="center">  <code>enable_joins_only</code>                </td><td> Setting <b><code>enable_joins_only</code></b> will cause the optimizer to only consider next plan candidates that are connected by a join to the existing partial plan. In other words, no <a href="http://dbpedia.org/resource/Cartesian_product" class="absuri">Cartesian products</a> will be considered. This may save some space and time. <b>Note:</b> This option is now the default with <b><code>3215</code></b>+ builds and there are no known cases when it should be set to 0. </td></tr></table>
<p>When reporting issues with query optimization, it will be useful to include statistics from the database in order to facilitate reproducing the effect.
 The <b><code><a href="http://docs.openlinksw.com/virtuoso/fn_stat_export.html" class="absuri">stat_export()</a></code></b> function produces a statistics summary that can be read back into another database with the <b><code><a href="http://docs.openlinksw.com/virtuoso/fn_stat_import.html" class="absuri">stat_import()</a></code></b> function.</p>
<ul><li>To export statistics: <br><pre><br>string_to_file (&#39;stat.dv&#39;, serialize(stat_export()), -2);

or

exp_stat_to_file (&#39;stat.dv&#39;);   which does not have 10MB file size limit
</pre><br> </li>
<li>To load exported statistics into a database: <br><pre><br>stat_import (deserialize (file_to_string (&#39;stat.dv&#39;)));
</pre><br> When exporting statistics as part of bug reporting, make sure to run the queries exhibiting the problem before exporting the stats.
 The queries drive statistics gathering.</li>
</ul><p> </p>
<h2><a name="Related"></a>Related</h2>
<ul><li><a href="http://ods.openlinksw.com:80/dataspace/owiki/wiki/ODS/VirtTipsAndTricksGuide" class="wikiword">Virtuoso Tips and Tricks Collection</a> </li>
<li><a href="http://docs.openlinksw.com/virtuoso/sqloptimizer.html" class="absuri">Virtuoso SQL Optimization</a> </li>
</ul></div></body></html>